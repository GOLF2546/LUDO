@main("Ludo Game", "game-page") {
<div class="custom-container">
  <div class="ludo-board">
    <div id="dice-result" style="font-size: 20px; margin: 20px 0">
      Click the button to roll the dice!
    </div>
    <button onclick="rollDice()">ðŸŽ² Roll Dice</button>
    <div id="game-players" style="font-size: 20px; margin: 20px 0">
      Click the button to start the game!
    </div>

    <button onclick="startGame()">Start Game</button>
    <div class="game-grid">
      <div class="home-base home-base-green">
        <div class="home-square">@components.pawnAtHome(4, "Green")</div>
      </div>

      <div class="path-vertical">@components.path(18, "Yellow")</div>

      <div class="home-base home-base-yellow">
        <div class="home-square">@components.pawnAtHome(4, "Yellow")</div>
      </div>

      <div class="path-horizontal">@components.path(18, "Green")</div>

      <div class="center-star">
        <div id="Y6" class="top-left"></div>
        <div id="B6" class="top-right"></div>
        <div id="G6" class="bottom-left"></div>
        <div id="R6" class="bottom-right"></div>
      </div>

      <div class="path-horizontal">@components.path(18, "Blue")</div>

      <div class="home-base home-base-red">
        <div class="home-square">@components.pawnAtHome(4, "Red")</div>
      </div>

      <div class="path-vertical">@components.path(18, "Red")</div>

      <div class="home-base home-base-blue">
        <div class="home-square">@components.pawnAtHome(4, "Blue")</div>
      </div>
    </div>
  </div>
  <div class="button-container3">
    <img
    src="@routes.Assets.versioned("images/components/button/homegamepage.png")"
    alt="home page" class="home-btn" onclick="homePage()">
  </div>
</div>

<script>
  function homePage() {
    window.location.href = "@routes.HomeController.index()";
  }
  let diceValue = null;

// Function to roll the dice and display the result
async function rollDice() {
  try {
    const response = await fetch("@routes.DiceController.rollDice.url", {
      method: "GET",
      headers: {
        Accept: "application/json",
      },
    });
    const result = await response.json();
    diceValue = result; // Store the dice value
    document.getElementById("dice-result").innerText = "Dice Roll: " + result;
  } catch (error) {
    console.error("Error rolling dice:", error);
    document.getElementById("dice-result").innerText =
      "Failed to roll the dice.";
  }
}

// Function to start the game and load player details
async function startGame() {
  try {
    const response = await fetch("@routes.GameController.startGame.url", {
      method: "GET",
      headers: { Accept: "application/json" },
    });
    const players = await response.json();

    let playerDetails = players
      .map((player) => {
        let pawnImages = player.pawns
          .map((p) => {
            // Construct the image path dynamically
            const imagePath = `/assets/images/components/pawn/${p.color.charAt(0).toLowerCase()}.png`;

            // Return the image HTML tag with onclick handler to select the pawn
            return `<img src="${imagePath}" alt="${p.color} pawn" onclick="selectPawn(${player.id}, '${p.color}', ${p.PawnId})">`;
          })
          .join(" ");

        return `Player ${player.id} (${player.color}): ${pawnImages}`;
      })
      .join("<br>");

    document.getElementById("game-players").innerHTML = playerDetails;
  } catch (error) {
    console.error("Error starting game:", error);
    document.getElementById("game-players").innerText =
      "Failed to start the game.";
  }
}

// Function to handle pawn click and send the pawn data with the dice roll value
async function selectPawn(playerId, color, pawnId) {
  if (diceValue === null) {
    alert("You must roll the dice first!");
    return;
  }

  try {
    const response = await fetch("@routes.GameController.handlePawnClick.url", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        pawnId: pawnId,
        color: color,
        diceValue: diceValue,
      }),
    });

    const updatedPlayer = await response.json();
    console.log("Player updated:", updatedPlayer);

    // Update the UI or give feedback to the user based on the response
  } catch (error) {
    console.error("Error handling pawn click:", error);
  }
}
</script>
}
